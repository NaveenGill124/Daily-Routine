<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Focus Sprint â€” Study Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-dark:#0b1220;
      --card:#0f1724;
      --muted:#94a3b8;
      --accent:linear-gradient(90deg,#7c3aed,#06b6d4);
      --amber:#f59e0b;
      --orange:#f97316;
      --success:#10b981;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.02);
      --text:#e6eef8;
      --text-muted:#9ca3af;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background: linear-gradient(180deg,#071129 0%, #071428 60%);
      color:var(--text);
      padding:22px;
      -webkit-font-smoothing:antialiased;
    }
    .container{
      max-width:1280px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:20px;
    }
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#7c3aed,#4f46e5);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px;box-shadow:0 10px 30px rgba(7,18,36,0.6)}
    h1{margin:0;font-size:20px}
    .lead{margin:0;color:var(--muted);font-size:13px}

    .main{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .progress-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .progress-card h4{margin:0 0 8px 0;display:flex;justify-content:space-between;align-items:center}
    .progress-bar{background:rgba(255,255,255,0.03);height:10px;border-radius:8px;overflow:hidden}
    .progress-inner{height:100%;border-radius:8px;background:linear-gradient(90deg,#f59e0b,#f97316);transition:width .5s ease}

    .task-inputs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .input, textarea, select{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:var(--text);font-family:inherit}
    .btn{background:linear-gradient(90deg,#7c3aed,#06b6d4);color:white;padding:10px 12px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
    .btn-muted{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
    .small{padding:8px 10px;font-size:13px}

    .task-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .task{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02)}
    .task .title{flex:1;font-weight:600;word-break:break-word}
    .task.done{opacity:0.55;text-decoration:line-through}
    .meta{font-size:12px;color:var(--muted)}

    .sidebar{display:flex;flex-direction:column;gap:12px}
    .notes{min-height:140px;resize:vertical;padding:10px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);background:transparent;color:var(--text)}
    .links-list,.rewards-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.008), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .phd-link{color:#7c3aed;text-decoration:none;font-weight:600}
    .small-muted{font-size:13px;color:var(--muted)}
    .toast-wrap{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:9999}

    .schedule-rows{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .sche{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .time{font-weight:700;color:#06b6d4}

    footer{grid-column:1/-1;margin-top:8px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:1024px){ .container{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="Study Dashboard">
    <header>
      <div class="brand">
        <div class="logo">N</div>
        <div>
          <h1>Focus Sprint â€” 2 Month Plan</h1>
          <p class="lead">DSA Â· Core CS Â· GenAI Â· Agentic AI Â· PhD apps</p>
        </div>
      </div>
      <div style="text-align:right">
        <div class="small-muted">Now: <strong id="nowClock">--</strong></div>
        <div class="small-muted">Streak: <strong id="streakCount">0</strong> ðŸ”¥</div>
      </div>
    </header>
    
    <p id="dailyQuote" class="small-muted" style="grid-column: 1 / -1; text-align: center; margin: -10px 0 20px 0;"></p>

    <main class="main">
      <section class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <h3 style="margin:0">Progress</h3>
          <div class="small-muted">Completed hours approximate from finished tasks</div>
        </div>
        <div class="progress-grid" id="progressGrid" style="margin-top:12px"></div>
      </section>

      <section class="card">
        <h3 style="margin-top:0">Today's Mission</h3>
        <div class="task-inputs">
          <input id="taskTitle" class="input" placeholder="Task title (e.g., BST video + 2 problems)" style="flex:1" aria-label="Task title"/>
          <select id="taskCategory" class="input" style="width:150px" aria-label="Task category">
            <option value="General">General</option>
            <option value="DSA">DSA</option>
            <option value="OOP">OOP</option>
            <option value="DBMS">DBMS</option>
            <option value="OS">OS</option>
            <option value="CN">CN</option>
            <option value="AI">AI/Agents</option>
            <option value="PhD">PhD Apps</option>
          </select>
          <input id="taskDue" class="input" type="datetime-local" style="width:210px" aria-label="Task due date"/>
          <input id="taskRem" class="input" type="number" min="0" placeholder="rem min" style="width:100px" aria-label="Reminder minutes"/>
          <button id="addTaskBtn" class="btn small" aria-label="Add new task">Add</button>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="prefillSchedule" class="btn small">Load Daily Schedule</button>
          <button id="clearDoneBtn" class="btn-muted small">Clear Completed</button>
          <button id="runMock" class="btn-muted small">Run 1-hr Mock</button>
          <div style="flex:1"></div>
          <div class="small-muted">Auto-save: local</div>
        </div>

        <div id="taskList" class="task-list" aria-live="polite"></div>
      </section>
    </main>

    <aside class="sidebar">
      <div class="card">
        <h4 style="margin:0 0 8px 0">Quick Notes</h4>
        <div class="small-muted">Autosaved</div>
        <textarea id="notesArea" class="notes" placeholder="Your notes, paper ideas, PhD drafts..."></textarea>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">PhD Opportunities</h4>
        <div class="small-muted">Save application pages / prof links</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="phdTitle" class="input" placeholder="Title (Prof X - Lab)" style="flex:1"/>
          <input id="phdUrl" class="input" placeholder="URL" style="width:160px"/>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="addPhd" class="btn small">Add</button>
          <button id="importPhd" class="btn-muted small">Import JSON</button>
        </div>
        <div id="phdList" class="links-list"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Rewards & Motivation</h4>
        <div class="small-muted">Add rewards and celebrate when earned</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="rewText" class="input" placeholder="Reward (e.g., Movie night)" style="flex:1"/>
          <button id="addReward" class="btn small">Add</button>
        </div>
        <div id="rewards" class="rewards-list"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Data & Schedule</h4>
        <div class="small-muted">Backup / restore or load default schedule</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="exportDataBtn" class="btn small">Export</button>
          <button id="importDataBtn" class="btn-muted small">Import</button>
          <input type="file" id="importFileInput" accept=".json" style="display:none" />
        </div>
        <div style="margin-top:10px">
          <button id="prefillTemplate" class="btn small">Insert Study Template Tasks</button>
        </div>
        <div class="small-muted" style="margin-top:8px">Notifications require permission when prompted.</div>
      </div>
    </aside>

    <footer>Save this file as <strong>index.html</strong>. Works locally or host on GitHub Pages. Data stored in browser localStorage.</footer>

    <div class="toast-wrap" id="toastWrap" aria-live="polite"></div>
  </div>

<script>
/* ----- Utility first (genId must come before defaultState) ----- */
/* ----- Utility ----- */
function genId(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,7); }

function todayTimeStr(hm){
  const d=new Date(); const [hh,mm]=hm.split(":");
  d.setHours(parseInt(hh,10),parseInt(mm,10),0,0);
  return toLocalInput(d);
}
function toLocalInput(d){
  const pad=n=>n<10? "0"+n: n;
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function escape(s){ if(!s) return ""; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function escapeAttr(s){ return escape(s).replace(/"/g,'&quot;'); }

function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }

/* ----- Daily Quote ----- */
const quotes = [
  "Push yourself, because no one else will do it for you.",
  "Dreams donâ€™t work unless you do.",
  "Stay consistent, even when itâ€™s hard.",
  "Every expert was once a beginner.",
  "Focus on progress, not perfection.",
  "Small steps each day lead to big results.",
  "Discipline beats motivation.",
  "Your only limit is you.",
  "Do it now. Sometimes â€˜laterâ€™ becomes â€˜neverâ€™.",
  "Hard work compounds â€” keep stacking!",
  "Consistency creates momentum.",
  "Win the morning, win the day."
];
function setDailyQuote(){
  const todayIndex = new Date().getDate() % quotes.length;
  document.getElementById("dailyQuote").textContent = `"${quotes[todayIndex]}"`;
}
setDailyQuote();
const now = new Date();
const msUntilMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1,0,0,0)-now;
setTimeout(()=>{ setDailyQuote(); setInterval(setDailyQuote,86400000); }, msUntilMidnight);

/* ----- Storage & State ----- */
const STORAGE_KEY = "focusSprint_v2";

const defaultState = {
  tasks: [
    {id:genId(), title:"DSA practice (BST) - watch + 3 problems", category:"DSA", due: todayTimeStr("09:00"), remMin:15, done:false},
    {id:genId(), title:"Core CS: OOP video (chunk)", category:"OOP", due: todayTimeStr("11:15"), remMin:10, done:false},
    {id:genId(), title:"GenAI - Transformers video + notebook", category:"AI", due: todayTimeStr("15:00"), remMin:15, done:false},
    {id:genId(), title:"PhD applications (1 hr) â€” draft emails", category:"PhD", due: todayTimeStr("20:30"), remMin:30, done:false},
    {id:genId(), title:"Night: DSA revision & LeetCode", category:"DSA", due: todayTimeStr("22:00"), remMin:10, done:false}
  ],
  notes: "Start each session by reviewing yesterday's notes.",
  phdLinks: [],
  rewards: [{id:genId(), text:"Ice cream (small)", earned:false},{id:genId(), text:"Movie night", earned:false}],
  schedule: [
    {time:"09:00-11:00", desc:"DSA Practice (2 hrs)"},
    {time:"11:15-13:00", desc:"Core CS (1.5 hrs)"},
    {time:"15:00-17:00", desc:"GenAI (2 hrs)"},
    {time:"17:15-17:30", desc:"Quick Revision (15 min)"},
    {time:"20:30-21:30", desc:"PhD Applications (1 hr)"},
    {time:"22:00-02:00", desc:"Night block: DSA / Core CS / Agents (4 hrs)"}
  ],
  streak:0,
  lastCompletionDate: null
};

let state = loadState();
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState)); return JSON.parse(JSON.stringify(defaultState)); }
    return JSON.parse(raw);
  }catch(e){ console.error(e); localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState)); return JSON.parse(JSON.stringify(defaultState)); }
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); renderAll(); }

/* ----- Streak Logic ----- */
function checkAndResetStreak(){
  if(!state.lastCompletionDate){ state.streak=0; return; }
  const today = new Date().toDateString();
  const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
  const yStr = yesterday.toDateString();
  if(state.lastCompletionDate !== today && state.lastCompletionDate !== yStr) state.streak=0;
}
function updateStreak(){
  const todayStr = new Date().toDateString();
  if(state.lastCompletionDate === todayStr) return;
  const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
  const yStr = yesterday.toDateString();
  state.streak = (state.lastCompletionDate === yStr) ? (state.streak||0)+1 : 1;
  state.lastCompletionDate = todayStr;
  saveState(); // <-- ensure streak is saved
  if(state.streak && state.streak%7===0){ toast("Streak milestone!", `You've hit ${state.streak} days â€” take a reward!`); notify("Streak milestone", `You've hit ${state.streak} days`); }
}

/* ----- Initial Render ----- */
checkAndResetStreak();
renderAll();
setInterval(()=>renderClock(),1000);



<script>
/* Focus Sprint â€” integrated JS
Â  Â  Features:
Â  Â  - tasks: add/edit/delete/check, due + reminder (minutes before)
Â  Â  - progress per subject estimated from completed tasks
Â  Â  - notes autosave
Â  Â  - PhD links (add/edit/delete)
Â  Â  - rewards (add/earn/delete)
Â  Â  - export/import JSON backup
Â  Â  - prefilled schedule & template loader
Â  Â  - toasts and browser notifications
Â  Â  - localStorage persistence
*/

/* ----- Daily Motivational Quote ----- */
const quotes = [
Â  "Push yourself, because no one else will do it for you.",
Â  "Dreams donâ€™t work unless you do.",
Â  "Stay consistent, even when itâ€™s hard.",
Â  "Every expert was once a beginner.",
Â  "Focus on progress, not perfection.",
Â  "Small steps each day lead to big results.",
Â  "Discipline beats motivation.",
Â  "Your only limit is you.",
Â  "Do it now. Sometimes â€˜laterâ€™ becomes â€˜neverâ€™.",
Â  "Hard work compounds â€” keep stacking!",
Â  "Consistency creates momentum.",
Â  "Win the morning, win the day."
];

function setDailyQuote(){
Â  const todayIndex = new Date().getDate() % quotes.length;
Â  document.getElementById("dailyQuote").textContent = `"${quotes[todayIndex]}"`;
}
setDailyQuote();

// auto-refresh quote at midnight
const now = new Date();
const msUntilMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,0) - now;
setTimeout(()=>{ setDailyQuote(); setInterval(setDailyQuote, 86400000); }, msUntilMidnight);


const STORAGE_KEY = "focusSprint_v2";

const defaultState = {
Â  tasks: [
Â  Â  // sample tasks for today's schedule
Â  Â  {id:genId(), title:"DSA practice (BST) - watch + 3 problems", category:"DSA", due: todayTimeStr("09:00"), remMin:15, done:false},
Â  Â  {id:genId(), title:"Core CS: OOP video (chunk)", category:"OOP", due: todayTimeStr("11:15"), remMin:10, done:false},
Â  Â  {id:genId(), title:"GenAI - Transformers video + notebook", category:"AI", due: todayTimeStr("15:00"), remMin:15, done:false},
Â  Â  {id:genId(), title:"PhD applications (1 hr) â€” draft emails", category:"PhD", due: todayTimeStr("20:30"), remMin:30, done:false},
Â  Â  {id:genId(), title:"Night: DSA revision & LeetCode", category:"DSA", due: todayTimeStr("22:00"), remMin:10, done:false}
Â  ],
Â  notes: "Start each session by reviewing yesterday's notes.",
Â  phdLinks: [],
Â  rewards: [{id:genId(), text:"Ice cream (small)", earned:false},{id:genId(), text:"Movie night", earned:false}],
Â  schedule: [
Â  Â  {time:"09:00-11:00", desc:"DSA Practice (2 hrs)"},
Â  Â  {time:"11:15-13:00", desc:"Core CS (1.5 hrs)"},
Â  Â  {time:"15:00-17:00", desc:"GenAI (2 hrs)"},
Â  Â  {time:"17:15-17:30", desc:"Quick Revision (15 min)"},
Â  Â  {time:"20:30-21:30", desc:"PhD Applications (1 hr)"},
Â  Â  {time:"22:00-02:00", desc:"Night block: DSA / Core CS / Agents (4 hrs)"},
Â  ],
Â  streak:0,
Â  lastCompletionDate: null
};

// subject configs for progress calculation
const SUBJECTS = {
Â  DSA: { totalHours: 60, color: '#f59e0b' },
Â  OOP: { totalHours: 5, color: '#8b5cf6' },
Â  DBMS: { totalHours: 12, color: '#06b6d4' },
Â  OS: { totalHours: 15, color: '#ec4899' },
Â  CN: { totalHours: 5, color: '#3b82f6' },
Â  AI: { totalHours: 42, color: '#f97316' },
Â  PhD: { totalHours: 20, color: '#7c3aed' },
Â  General: { totalHours: 20, color: '#94a3b8' }
};

let state = loadState();

function genId(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,7); }
function todayTimeStr(hm){
Â  const d=new Date(); const [hh,mm]=hm.split(":");
Â  d.setHours(parseInt(hh,10),parseInt(mm,10),0,0);
Â  return toLocalInput(d);
}
function toLocalInput(d){
Â  const pad=n=>n<10? "0"+n: n;
Â  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
}
function loadState(){
Â  try{
Â  Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  Â  if(!raw){ localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState)); return JSON.parse(JSON.stringify(defaultState)); }
Â  Â  return JSON.parse(raw);
Â  }catch(e){ console.error(e); localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState)); return JSON.parse(JSON.stringify(defaultState)); }
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); renderAll(); }

/* ----- DOM refs ----- */
const $ = s=>document.querySelector(s);
const taskListEl = $("#taskList");
const progressGrid = $("#progressGrid");
const notesArea = $("#notesArea");
const nowClock = $("#nowClock");
const streakCountEl = $("#streakCount");
const toastWrap = $("#toastWrap");
const phdListEl = $("#phdList");
const rewardsEl = $("#rewards");

/* ----- Renderers ----- */
function renderAll(){
Â  renderClock();
Â  renderProgress();
Â  renderTasks();
Â  renderNotes();
Â  renderPhdLinks();
Â  renderRewards();
Â  renderStreak();
}
function renderClock(){
Â  const d=new Date(); nowClock.textContent = d.toLocaleString();
}
function renderProgress(){
Â  progressGrid.innerHTML = "";
Â  // compute completed hours per subject:Â  each completed task counted as 1.5 hours (approx)
Â  const completed = {};
Â  Object.keys(SUBJECTS).forEach(k=>completed[k]=0);
Â  (state.tasks||[]).forEach(t=>{ if(t.done){ const cat = t.category || "General"; completed[cat] = (completed[cat]||0) + 1.5; }});
Â  for(const s in SUBJECTS){
Â  Â  const conf = SUBJECTS[s];
Â  Â  const hours = completed[s] || 0;
Â  Â  const pct = Math.min(100, Math.round((hours / conf.totalHours)*100));
Â  Â  const card = document.createElement("div");
Â  Â  card.className = "progress-card card";
Â  Â  card.innerHTML = `<h4>${s}<span class="small-muted">${hours.toFixed(1)} / ${conf.totalHours} hrs</span></h4>
Â  Â  Â  <div class="progress-bar"><div class="progress-inner" style="width:${pct}%; background:${conf.color}"></div></div>`;
Â  Â  progressGrid.appendChild(card);
Â  }
}
function renderTasks(){
Â  if(!state.tasks || state.tasks.length===0){
Â  Â  taskListEl.innerHTML = '<div class="small-muted">No tasks yet â€” add one above.</div>'; return;
Â  }
Â  // sort by done then due
Â  const arr = state.tasks.slice().sort((a,b)=> (a.done - b.done) || (new Date(a.due||0) - new Date(b.due||0)));
Â  taskListEl.innerHTML = "";
Â  arr.forEach(t=>{
Â  Â  const row = document.createElement("div");
Â  Â  row.className = "task"+(t.done? " done":"");
Â  Â  row.innerHTML = `
Â  Â  Â  <input type="checkbox" ${t.done? "checked":""} data-id="${t.id}" aria-label="done-${t.title}" />
Â  Â  Â  <div style="flex:1">
Â  Â  Â  Â  <div class="title">${escape(t.title)} <span class="small-muted" style="font-weight:400">[${t.category||'General'}]</span></div>
Â  Â  Â  Â  <div class="meta">${t.due? new Date(t.due).toLocaleString() : 'No due'} Â· ${t.remMin? t.remMin+'m before':''}</div>
Â  Â  Â  </div>
Â  Â  Â  <div style="display:flex;gap:8px">
Â  Â  Â  Â  <button class="btn-muted small" data-edit="${t.id}">Edit</button>
Â  Â  Â  Â  <button class="btn small" data-del="${t.id}" style="background:linear-gradient(90deg,#ef4444,#f43f5e)">Delete</button>
Â  Â  Â  </div>`;
Â  Â  // checkbox listener
Â  Â  row.querySelector(`input[type="checkbox"]`).addEventListener("change", e=>{
Â  Â  Â  t.done = e.target.checked;
Â  Â  Â  if(t.done) updateStreak();
Â  Â  Â  saveState();
Â  Â  });
Â  Â  row.querySelector(`[data-edit="${t.id}"]`).addEventListener("click", ()=> editTask(t.id));
Â  Â  row.querySelector(`[data-del="${t.id}"]`).addEventListener("click", ()=> {
Â  Â  Â  if(!confirm("Delete this task?")) return;
Â  Â  Â  state.tasks = state.tasks.filter(x=>x.id!==t.id); saveState(); toast("Task deleted");
Â  Â  });
Â  Â  taskListEl.appendChild(row);
Â  });
}
function renderNotes(){ notesArea.value = state.notes || ""; }
function renderPhdLinks(){
Â  phdListEl.innerHTML = "";
Â  if(!state.phdLinks || state.phdLinks.length===0) { phdListEl.innerHTML = '<div class="small-muted">No PhD links saved.</div>'; return; }
Â  state.phdLinks.forEach(l=>{
Â  Â  const el = document.createElement("div"); el.className="row";
Â  Â  el.innerHTML = `<div style="flex:1"><a class="phd-link" href="${escapeAttr(l.url)}" target="_blank" rel="noopener">${escape(l.title)}</a>
Â  Â  Â  <div class="small-muted" style="margin-top:6px">${escape(l.url)}</div></div>
Â  Â  Â  <div style="display:flex;gap:8px">
Â  Â  Â  Â  <button class="btn-muted small" data-edit="${l.id}">Edit</button>
Â  Â  Â  Â  <button class="btn small" data-del="${l.id}" style="background:linear-gradient(90deg,#ef4444,#f43f5e)">Delete</button>
Â  Â  Â  </div>`;
Â  Â  el.querySelector(`[data-edit="${l.id}"]`).addEventListener("click", ()=>{
Â  Â  Â  const newT = prompt("Edit title", l.title); if(newT===null) return;
Â  Â  Â  const newU = prompt("Edit URL", l.url); if(newU===null) return;
Â  Â  Â  l.title = newT; l.url = newU; saveState(); toast("Link updated");
Â  Â  });
Â  Â  el.querySelector(`[data-del="${l.id}"]`).addEventListener("click", ()=>{
Â  Â  Â  if(!confirm("Remove this link?")) return;
Â  Â  Â  state.phdLinks = state.phdLinks.filter(x=>x.id!==l.id); saveState(); toast("Link removed");
Â  Â  });
Â  Â  phdListEl.appendChild(el);
Â  });
}
function renderRewards(){
Â  rewardsEl.innerHTML = "";
Â  if(!state.rewards || state.rewards.length===0){ rewardsEl.innerHTML = '<div class="small-muted">No rewards yet.</div>'; return; }
Â  state.rewards.forEach(r=>{
Â  Â  const el = document.createElement("div"); el.className="row";
Â  Â  el.innerHTML = `<div style="flex:1"><strong ${r.earned? 'style="text-decoration:line-through;opacity:.6"':""}>${escape(r.text)}</strong>
Â  Â  Â  <div class="small-muted">Click Earn to mark</div></div>
Â  Â  Â  <div style="display:flex;gap:8px">
Â  Â  Â  Â  <button class="btn small" data-earn="${r.id}" style="background:linear-gradient(90deg,#10b981,#059669)">Earn</button>
Â  Â  Â  Â  <button class="btn-muted small" data-del="${r.id}">Delete</button>
Â  Â  Â  </div>`;
Â  Â  el.querySelector(`[data-earn="${r.id}"]`).addEventListener("click", ()=>{
Â  Â  Â  r.earned = !r.earned; saveState();
Â  Â  Â  if(r.earned) { toast("Reward earned ðŸŽ‰", r.text); notify("Reward earned", r.text); }
Â  Â  });
Â  Â  el.querySelector(`[data-del="${r.id}"]`).addEventListener("click", ()=>{
Â  Â  Â  if(!confirm("Delete reward?")) return;
Â  Â  Â  state.rewards = state.rewards.filter(x=>x.id!==r.id); saveState();
Â  Â  });
Â  Â  rewardsEl.appendChild(el);
Â  });
}
function renderStreak(){ streakCountEl.textContent = state.streak || 0; }

/* ----- helpers ----- */
function escape(s){ if(!s) return ""; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function escapeAttr(s){ return escape(s).replace(/"/g,'&quot;'); }
function toast(title, text=""){ const node=document.createElement("div"); node.className="card"; node.style.minWidth="240px"; node.innerHTML=`<strong>${escape(title)}</strong><div class="small-muted" style="margin-top:6px">${escape(text)}</div>`; toastWrap.prepend(node); setTimeout(()=>node.style.opacity=0,6000); setTimeout(()=>node.remove(),6800); }

/* ----- event wiring ----- */
document.getElementById("addTaskBtn").addEventListener("click", ()=>{
Â  const title = document.getElementById("taskTitle").value.trim();
Â  const cat = document.getElementById("taskCategory").value;
Â  const due = document.getElementById("taskDue").value || null;
Â  const remMin = parseInt(document.getElementById("taskRem").value || 0,10) || 0;
Â  if(!title){ alert("Provide a title"); return; }
Â  state.tasks.push({id:genId(), title, category:cat, due: due, remMin: remMin, done:false});
Â  document.getElementById("taskTitle").value=""; document.getElementById("taskDue").value=""; document.getElementById("taskRem").value="";
Â  saveState(); toast("Task added", title);
});

document.getElementById("clearDoneBtn").addEventListener("click", ()=>{
Â  state.tasks = state.tasks.filter(t=>!t.done); saveState(); toast("Cleared completed tasks");
});
document.getElementById("runMock").addEventListener("click", ()=>{
Â  const now = new Date(); const start = new Date(now.getTime()+10*60000); state.tasks.push({id:genId(), title:"1-hr Mock Test", category:"General", due: toLocalInput(start), remMin:5, done:false}); saveState(); toast("Mock scheduled");
});

document.getElementById("prefillSchedule").addEventListener("click", ()=>{
Â  if(!confirm("Load today's schedule as tasks?")) return;
Â  (state.schedule||[]).forEach(s=>{
Â  Â  const m = s.time.match(/(\d{2}:\d{2})/);
Â  Â  if(!m) return;
Â  Â  state.tasks.push({id:genId(), title:s.desc, category:"General", due: todayTimeStr(m[1]), remMin:15, done:false});
Â  });
Â  saveState(); toast("Schedule loaded");
});

document.getElementById("prefillTemplate").addEventListener("click", ()=>{
Â  if(!confirm("Insert study template tasks?")) return;
Â  // sample template tasks to help mapping video durations
Â  const template = [
Â  Â  {title:"Watch OOP video (chunk)", category:"OOP"},
Â  Â  {title:"DBMS: normalization video (chunk)", category:"DBMS"},
Â  Â  {title:"OS: process & threads video (chunk)", category:"OS"},
Â  Â  {title:"GenAI: Transformers video + notebook", category:"AI"},
Â  Â  {title:"Agentic AI: LangChain intro", category:"AI"},
Â  Â  {title:"PhD: draft application email", category:"PhD"}
Â  ];
Â  const now = new Date();
Â  template.forEach((t,i)=> state.tasks.push({id:genId(), title:t.title, category:t.category, due: toLocalInput(new Date(now.getTime() + (i+1)*3600000)), remMin:15, done:false}));
Â  saveState(); toast("Template inserted");
});

/* ----- notes autosave ----- */
const notesAreaEl = document.getElementById("notesArea");
notesAreaEl.addEventListener("input", debounce(()=>{ state.notes = notesAreaEl.value; saveState(); }, 600));

/* ----- phd links ----- */
document.getElementById("addPhd").addEventListener("click", ()=>{
Â  const t = document.getElementById("phdTitle").value.trim();
Â  const u = document.getElementById("phdUrl").value.trim();
Â  if(!t || !u){ alert("Provide title and url"); return; }
Â  state.phdLinks = state.phdLinks || []; state.phdLinks.push({id:genId(), title:t, url:u}); document.getElementById("phdTitle").value=""; document.getElementById("phdUrl").value=""; saveState(); toast("PhD link added", t);
});

/* ----- rewards ----- */
document.getElementById("addReward").addEventListener("click", ()=>{
Â  const text = document.getElementById("rewText").value.trim(); if(!text) return alert("Add reward text");
Â  state.rewards = state.rewards || []; state.rewards.push({id:genId(), text, earned:false}); document.getElementById("rewText").value=""; saveState(); toast("Reward added");
});

/* ----- export / import ----- */
document.getElementById("exportDataBtn").addEventListener("click", ()=>{
Â  const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=`focus-sprint-backup-${new Date().toISOString().split('T')[0]}.json`; a.click(); URL.revokeObjectURL(a.href);
});
document.getElementById("importDataBtn").addEventListener("click", ()=> document.getElementById("importFileInput").click());
document.getElementById("importFileInput").addEventListener("change", e=>{
Â  const file = e.target.files[0]; if(!file) return;
Â  const reader = new FileReader(); reader.onload = ev=>{
Â  Â  try{ const imported = JSON.parse(ev.target.result); state = {...defaultState, ...imported}; saveState(); toast("Data imported"); } catch(err){ alert("Invalid file"); }
Â  }; reader.readAsText(file);
});

/* ----- task edit ----- */
function editTask(id){
Â  const t = state.tasks.find(x=>x.id===id); if(!t) return;
Â  const newT = prompt("Edit title", t.title); if(newT===null) return;
Â  const newDue = prompt("Due (YYYY-MM-DDTHH:MM) or empty", t.due||""); if(newDue===null) return;
Â  const newRem = prompt("Reminder minutes before (0 none)", t.remMin||0); if(newRem===null) return;
Â  t.title = newT.trim()||t.title; t.due = newDue.trim()||null; t.remMin = parseInt(newRem,10)||0; saveState(); toast("Task updated");
}

/* ----- reminders & notifications ----- */
let notifiedSet = new Set();
function checkReminders(){
Â  const now = new Date();
Â  (state.tasks||[]).forEach(t=>{
Â  Â  if(!t.due || t.done) return;
Â  Â  const due = new Date(t.due);
Â  Â  const remMin = parseInt(t.remMin||0,10);
Â  Â  const trigger = new Date(due.getTime() - remMin*60000);
Â  Â  if(now >= trigger && !notifiedSet.has("rem:"+t.id)){
Â  Â  Â  const msg = `${t.title} â€” due at ${due.toLocaleTimeString()}`;
Â  Â  Â  toast("Reminder", msg); notify("Study Dashboard", msg);
Â  Â  Â  notifiedSet.add("rem:"+t.id);
Â  Â  }
Â  Â  if(now > due && !notifiedSet.has("over:"+t.id)){
Â  Â  Â  toast("Overdue", `${t.title} was due at ${due.toLocaleTimeString()}`); notify("Overdue", t.title);
Â  Â  Â  notifiedSet.add("over:"+t.id);
Â  Â  }
Â  });
}
function notify(title, body){
Â  if(!("Notification" in window)) return;
Â  if(Notification.permission === "granted"){ new Notification(title, {body}); }
Â  else if(Notification.permission === "default"){ Notification.requestPermission().then(p=>{ if(p==="granted") new Notification(title,{body}); }); }
}
tryRequestNotification();
setInterval(checkReminders,30*1000); checkReminders();

/* ----- streak logic ----- */
/**
 * Checks if the streak was broken (i.e., no task completed yesterday)
 * and resets it to 0 if necessary. This runs on page load.
 */
function checkAndResetStreak() {
  if (!state.lastCompletionDate) {
    state.streak = 0;
    return;
  }
  const todayStr = new Date().toDateString();
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  const yesterdayStr = yesterday.toDateString();

  // If the last completion was not today and not yesterday, the streak is broken.
  if (state.lastCompletionDate !== todayStr && state.lastCompletionDate !== yesterdayStr) {
    state.streak = 0;
  }
}

/**
 * Updates the streak when a task is marked as complete.
 */
function updateStreak(){
Â  const todayStr = new Date().toDateString();
Â  // If a task was already completed today, don't update the streak again.
Â  if(state.lastCompletionDate === todayStr) return;

Â  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate()-1);
  const yesterdayStr = yesterday.toDateString();

  // If the last completion was yesterday, it's a combo! Increment the streak.
  // Otherwise, the streak was broken or just starting, so set it to 1.
Â  state.streak = (state.lastCompletionDate === yesterdayStr) ? (state.streak || 0) + 1 : 1;
Â  state.lastCompletionDate = todayStr;

Â  // Bonus reward on streak milestone
Â  if(state.streak && (state.streak % 7 === 0)){
Â  Â  toast("Streak milestone!", `You've hit ${state.streak} days â€” take a reward!`);
Â  Â  notify("Streak milestone", `You've hit ${state.streak} days`);
Â  }
}


/* ----- periodic UI updates ----- */
setInterval(()=>{ renderClock(); }, 1000);

checkAndResetStreak(); // <-- KEY CHANGE: Check streak on page load
renderAll();


/* ----- utility ----- */
function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }

// ensure state saved to localStorage on unload
window.addEventListener("beforeunload", ()=> saveState());

// request notifications
function tryRequestNotification(){ if("Notification" in window && Notification.permission === "default") Notification.requestPermission(); }

/* ----- initial save if not present ----- */
if(!localStorage.getItem(STORAGE_KEY)) { saveState(); }
</script>
</body>
</html>


